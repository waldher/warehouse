<script type="text/javascript">
  $(document).ready(function(){
    $('#real_estate_ad_description').tinymce({
      script_url: '<%= javascript_path("tiny_mce/tiny_mce.js") %>',
      theme: 'advanced',
      theme_advanced_toolbar_location : "top",
      theme_advanced_toolbar_align : "left",
      plugins : "autolink,lists,spellchecker,pagebreak,style,layer,table,save,advhr,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template",
      theme_advanced_buttons1 : "save,newdocument,|,bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,styleselect,formatselect,fontselect,fontsizeselect",
      theme_advanced_buttons2 : "cut,copy,paste,pastetext,pasteword,|,search,replace,|,bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,anchor,cleanup,help,code,|,insertdate,inserttime,preview,|,forecolor,backcolor",
      theme_advanced_buttons3 : "tablecontrols,|,hr,removeformat,visualaid,|,sub,sup,|,charmap,emotions,iespell,advhr,|,print,|,ltr,rtl,|,fullscreen",
      theme_advanced_buttons4 : "insertlayer,moveforward,movebackward,absolute,|,styleprops,spellchecker,|,cite,abbr,acronym,del,ins,attribs,|,visualchars,nonbreaking,template,blockquote,pagebreak"
    });
  });
</script>

<%= form_for([@customer, @listing], :html => {:multipart => true}) do |f| %>
  <% f.fields_for :infos do |infos| %>
    <% if @listing.errors.any? %>
      <div id="error_explanation">
        <h2><%= pluralize(@listing.errors.count, "error") %> prohibited this listing from being saved:</h2>

        <ul>
        <% @listing.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
        </ul>
      </div>
    <% end %>

    <div>
      <span class="field">
        <%= infos.label :ad_title, "Ad Title" %><br />
        <%= infos.text_field :ad_title, :maxlength => 70, :size => 70, :value => @listing.infos[:ad_title] %>
      </span>
      <span class="field">
        <%= infos.label :ad_location, "Ad Location" %><br />
        <%= infos.text_field :ad_location, :value => @listing.infos[:ad_location] %>
      </span>
    </div>
    <div>
      <span class="field">
        <%= infos.label :ad_address, "Address" %><br />
        <%= infos.text_field :ad_address, :max_length => 70, :size => 70, :value => @listing.infos[:ad_address]  %>
      </span>
    </div>
    <div>
      <span class="field">
        <%= infos.label :ad_price, "Price" %><br />
        <%= infos.text_field :ad_price, :maxlength => 7, :size => 7, :value => @listing.infos[:ad_price] %>
      </span>
      <span class="field">
        <%= infos.label :ad_bedrooms, "Bedrooms" %><br />
        <%= infos.select :ad_bedrooms, 0..8, :selected => @listing.infos[:ad_bedrooms] %>
      </span>
      <% if @customer.has_capability?("bathrooms") %>
        <span class="field">
          <%= infos.label :ad_bathrooms, "Bathrooms" %><br />
          <%= infos.select :ad_bathrooms, (0..16).collect{|n| n/2.0}, :selected => @listing.infos[:ad_bathrooms] %>
        </span>
      <% end %>
      <% if @customer.has_capability?("sqft") %>
        <span class="field">
          <%= infos.label :ad_sqft, "Square Feet" %><br />
          <%= infos.text_field :ad_sqft, :value => @listing.infos[:ad_sqft], :size => 5 %>
        </span>
      <% end %>
      <% if @customer.has_capability?("style") %>
        <span class="field">
          <%= infos.label :ad_style, "Style" %><br />
          <%= infos.text_field :ad_style, :value => (@listing.infos[:ad_style] or "Condominium") %>
        </span>
      <% end %>
    </div>
    <div class="field">
      <%= infos.label :ad_description, "Ad Description" %><br />
      <%= infos.text_area :ad_description, :value => @listing.infos[:ad_description] %>
    </div>
    <div class="field">
      <%= infos.label :ad_keywords, "Keywords" %><br />
      <%= infos.text_field :ad_keywords, :maxlength => '100', :value => @listing.infos[:ad_keywords] %>
    </div>
    <div>
      <span class="field">
        <% checked = @listing.infos[:ad_cats] == "1" ? true : false %>
        <%= infos.label :ad_cats, "Cats" %> 
        <%= infos.check_box :ad_cats, { :checked => checked } %>
      </span>
      <span class="field">
        <% checked = @listing.infos[:ad_dogs] == "1" ? true : false %>
        <%= infos.label :ad_dogs, "Dogs" %>
        <%= infos.check_box :ad_dogs, { :checked => checked } %>
      </span>
    </div>

    <label>Images</label><br />
    <div>
      <%= link_to_add_fields("Add Image", f, :listing_images) %>
    </div>
    <div id="listing_images_id">
      <% f.fields_for :listing_images do |builder| %>
        <span class="image_upload">
          <%= render 'listing_image_fields', :f => builder %>
          <%# radio_button_tag builder.object_name.gsub(/.*\[/, '').gsub(/\]/, '') %>
        </span>
      <% end %>
    </div>
    <div>
      <%= link_to_add_fields("Add Image", f, :listing_images) %>
    </div>

    <div class="field">
      <%= f.label :active, "Activate this listing" %>
      <%= f.check_box :active %>
    </div>
    <div class="actions">
      <%= f.submit %>
    </div>
  <% end %>
<% end %>
